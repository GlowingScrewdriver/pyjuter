name: CI

on:
  push:
    branches: [ "master" ]

  workflow_dispatch:

permissions:
  # Reference: https://github.com/actions/deploy-pages?tab=readme-ov-file#security-considerations
  id-token: write
  pages: write

jobs:
  # Install the package and use Pdoc to generate documentation
  # Results are uploaded as a Pages artifact
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up a Venv
        run: |
          python3 -m venv ./venv
          ./venv/bin/pip3 install . pdoc

      - name: Generate docs
        run: ./venv/bin/python3 -m pdoc pyjuter -o gen-docs

      - name: Upload docs artifact
        id: docs
        uses: actions/upload-pages-artifact@v3
        with:
          path: gen-docs/

  # Deploy the artifact from `build` to Pages
  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Deploy docs
        id: docs
        uses: actions/deploy-pages@v4
